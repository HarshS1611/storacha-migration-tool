(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4409)}])},4409:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var a=t(5893),r=t(7294);let l=e=>{let{progress:s,label:t,showPercentage:r=!0,color:l="storacha",height:i="md",animate:n=!0}=e,c=Math.min(Math.max(s,0),100),d=()=>{switch(i){case"sm":return"h-2";case"lg":return"h-6";default:return"h-4"}};return(0,a.jsxs)("div",{className:"w-full",children:[t&&(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:t}),r&&(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[c.toFixed(1),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full ".concat(d()),children:(0,a.jsx)("div",{className:"".concat((()=>{switch(l){case"green":return"bg-success";case"yellow":return"bg-warning";case"red":return"bg-error";default:return"bg-storacha"}})()," rounded-full ").concat(d()," ").concat(n?"transition-all duration-500":""),style:{width:"".concat(c,"%")},children:"lg"===i&&r&&(0,a.jsxs)("div",{className:"flex items-center justify-center h-full text-xs font-medium text-white",children:[c.toFixed(1),"%"]})})})]})};function i(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(s))+" "+["B","KB","MB","GB","TB","PB"][t]}function n(e){if(e<0)return"Unknown";if(0===e)return"0s";if(e<1)return"Less than 1s";let s=Math.floor(e/3600),t=Math.floor(e%3600/60),a="";return s>0&&(a+="".concat(s,"h ")),(t>0||s>0)&&(a+="".concat(t,"m ")),a+="".concat(Math.floor(e%60),"s")}function c(e){return"".concat(i(e),"/s")}let d=e=>{let{onFileDownload:s}=e,[t,d]=(0,r.useState)({region:"",accessKeyId:"",secretAccessKey:"",bucketName:"",objectKey:""}),[o,m]=(0,r.useState)({loaded:0,total:0,percentage:0,speed:0,timeRemaining:0,status:"idle"}),[h,x]=(0,r.useState)(!1),u=e=>{let{name:s,value:t}=e.target;d(e=>({...e,[s]:t}))},p=async e=>{e.preventDefault();try{x(!0),m({loaded:0,total:0,percentage:0,speed:0,timeRemaining:0,status:"downloading",startTime:new Date});let e=(()=>{let e=0,s=setInterval(()=>{e++;let t=Math.min(95,e/30*100);m(s=>({...s,loaded:Math.floor(5242880*t/100),total:5242880,percentage:t,speed:1747626.6666666667,timeRemaining:(30-e)*100/1e3})),e>=30&&clearInterval(s)},100);return s})(),a=await fetch("/api/migrate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"migrateFile",s3Config:{region:t.region,bucketName:t.bucketName,credentials:{accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey}},fileKey:t.objectKey})});if(clearInterval(e),!a.ok){let e=await a.json();throw Error(e.message||"Failed to download file")}let r=await a.json();if(!r.success)throw Error(r.message||"Failed to download file");let l=new File([new Uint8Array(10)],r.fileName||t.objectKey.split("/").pop()||"downloaded-file",{type:r.contentType||"application/octet-stream"});m(e=>({...e,status:"completed",percentage:100,loaded:l.size,total:l.size,endTime:new Date})),s(l)}catch(e){m(s=>({...s,status:"error",error:e instanceof Error?e.message:"Unknown error"}))}finally{x(!1)}};return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Download from S3"}),(0,a.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Region"}),(0,a.jsx)("input",{type:"text",name:"region",value:t.region,onChange:u,className:"input w-full",placeholder:"e.g., us-east-1",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bucket Name"}),(0,a.jsx)("input",{type:"text",name:"bucketName",value:t.bucketName,onChange:u,className:"input w-full",placeholder:"e.g., my-bucket",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Access Key ID"}),(0,a.jsx)("input",{type:"text",name:"accessKeyId",value:t.accessKeyId,onChange:u,className:"input w-full",placeholder:"Your AWS Access Key ID",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Secret Access Key"}),(0,a.jsx)("input",{type:"password",name:"secretAccessKey",value:t.secretAccessKey,onChange:u,className:"input w-full",placeholder:"Your AWS Secret Access Key",required:!0})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Object Key"}),(0,a.jsx)("input",{type:"text",name:"objectKey",value:t.objectKey,onChange:u,className:"input w-full",placeholder:"e.g., path/to/file.jpg",required:!0})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",className:"btn btn-primary w-full",disabled:h,children:h?"Downloading...":"Download from S3"})})]}),"idle"!==o.status&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Download Progress"}),(0,a.jsx)(l,{progress:o.percentage,label:"Download Progress",color:"error"===o.status?"red":"completed"===o.status?"green":"storacha",height:"lg"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"File Size"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:i(o.total)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Downloaded"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[i(o.loaded)," (",o.percentage.toFixed(1),"%)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Download Speed"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:c(o.speed)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Time Remaining"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:"completed"===o.status?"Completed":n(o.timeRemaining)})]}),o.fileName&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Current File"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-ellipsis overflow-hidden",children:o.fileName})]})]}),"error"===o.status&&(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("p",{className:"text-red-700",children:o.error})]}),"completed"===o.status&&(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-green-800",children:"Success"}),(0,a.jsx)("p",{className:"text-green-700",children:"File downloaded successfully! Ready to upload to Storacha."}),o.fileName&&(0,a.jsxs)("p",{className:"text-sm text-green-700 mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Filename:"})," ",o.fileName]})]})]})]})},o=e=>{let{file:s}=e,[t,d]=(0,r.useState)({email:"",space:""}),[o,m]=(0,r.useState)({loaded:0,total:0,percentage:0,speed:0,timeRemaining:0,status:"idle"}),[h,x]=(0,r.useState)([]),[u,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{t.email&&t.email.includes("@")&&j()},[t.email]);let j=async()=>{try{if(!t.email.includes("@"))return;x(["Default Space"])}catch(e){console.error("Error fetching spaces:",e)}},N=e=>{let{name:s,value:t}=e.target;d(e=>({...e,[s]:t}))},b=async e=>{if(e.preventDefault(),!s){alert("Please download a file from S3 first");return}try{if(!t.email||!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t.email))throw Error("Invalid email format. Email must be in the format user@domain.com");p(!0),m({loaded:0,total:s.size,percentage:0,speed:0,timeRemaining:0,status:"uploading",phase:"initializing",phaseMessage:"Preparing upload...",startTime:new Date,fileName:s.name}),console.log("Uploading file ".concat(s.name," (").concat(s.size," bytes) with email: ").concat(t.email));let e=new FormData;e.append("file",s),e.append("email",t.email),t.space&&e.append("space",t.space);try{var a,r;let s=await fetch("/api/storacha-upload",{method:"POST",body:e});if(!s.ok){let e=await s.json();throw Error(e.message||"Upload failed")}let t=null===(a=s.body)||void 0===a?void 0:a.getReader(),l=null;if(t){let e="";for(;;){let{done:s,value:a}=await t.read();if(s){if(e.trim())try{let s=e.split("\n").filter(e=>e.trim()).pop();s&&s.includes('"success":')&&(l=JSON.parse(s))}catch(e){console.error("Error parsing final result:",e)}break}let i=new TextDecoder().decode(a),n=(e+=i).split("\n");for(let s of(e=n.pop()||"",n))if(s.trim()&&s.includes("{"))try{let e=JSON.parse(s);if(e.phase){let s=null!==(r=e.percentage)&&void 0!==r?r:0;m(t=>({...t,phase:e.phase,phaseMessage:e.message,percentage:s,status:"completed"===e.phase?"completed":"error"===e.phase?"error":"uploading"}))}void 0!==e.success&&e.cid&&(l=e)}catch(e){console.error("Error parsing progress update:",e,s)}}if(l&&l.success&&l.cid)y(l);else if(!l)throw Error("No final result received from server")}else throw Error("Unable to read response stream")}catch(e){console.error("Error during upload:",e),m(s=>({...s,status:"error",phase:"error",phaseMessage:e instanceof Error?e.message:"Unknown error",error:e instanceof Error?e.message:"Unknown error"})),p(!1)}}catch(e){m(s=>({...s,status:"error",phase:"error",phaseMessage:e instanceof Error?e.message:"Unknown error",error:e instanceof Error?e.message:"Unknown error"})),p(!1)}},y=e=>{m(t=>({...t,loaded:(null==s?void 0:s.size)||0,total:(null==s?void 0:s.size)||0,percentage:100,status:"completed",endTime:new Date,cid:e.cid,url:e.url})),p(!1)};return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Upload to Storacha"}),s?(0,a.jsxs)("div",{className:"mb-4 p-3 bg-storacha-50 border border-storacha-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-storacha-800",children:"Selected File"}),(0,a.jsxs)("p",{className:"text-storacha-700",children:[s.name," (",i(s.size),")"]})]}):(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No File Selected"}),(0,a.jsx)("p",{className:"text-yellow-700",children:"Please download a file from S3 first."})]}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Storacha Email"}),(0,a.jsx)("input",{type:"email",name:"email",value:t.email,onChange:N,className:"input w-full",placeholder:"your.email@example.com",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"we will validate your email and subsciption status"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Space (Optional)"}),(0,a.jsxs)("select",{name:"space",value:t.space,onChange:N,className:"input w-full",children:[(0,a.jsx)("option",{value:"",children:"-- Use Default Space --"}),h.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"If no space is selected, the default space will be used."})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",className:"btn btn-primary w-full",disabled:u||!s,children:u?"Uploading...":"Upload to Storacha"})})]}),"idle"!==o.status&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Upload Progress"}),o.phase&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsxs)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center mr-2 \n                  ".concat("error"===o.phase?"bg-red-100 text-red-600":"completed"===o.phase?"bg-green-100 text-green-600":"bg-storacha-100 text-storacha-600"),children:["initializing"===o.phase&&"\uD83D\uDEE0️","authenticating"===o.phase&&"\uD83D\uDD11","preparing"===o.phase&&"⏳","uploading"===o.phase&&"\uD83D\uDCE4","finalizing"===o.phase&&"✅","completed"===o.phase&&"✓","error"===o.phase&&"❌"]}),(0,a.jsxs)("span",{className:"font-medium",children:["initializing"===o.phase&&"Initializing","authenticating"===o.phase&&"Authenticating","preparing"===o.phase&&"Preparing","uploading"===o.phase&&"Uploading","finalizing"===o.phase&&"Finalizing","completed"===o.phase&&"Completed","error"===o.phase&&"Error"]})]}),o.phaseMessage&&(0,a.jsx)("p",{className:"text-sm text-gray-600 ml-10",children:o.phaseMessage})]}),(0,a.jsx)(l,{progress:o.percentage,label:"Overall Progress",color:"error"===o.status?"red":"completed"===o.status?"green":"storacha",height:"lg"}),o.shardProgress&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(l,{progress:o.shardProgress.percentage,label:"Shard ".concat(o.shardProgress.shardIndex+1,"/").concat(o.shardProgress.totalShards),color:"yellow"})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"File Size"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:i(o.total)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Uploaded"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[i(o.loaded)," (",o.percentage.toFixed(1),"%)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Upload Speed"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:c(o.speed)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Time Remaining"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:"completed"===o.status?"Completed":n(o.timeRemaining)})]}),o.fileName&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Current File"}),(0,a.jsx)("p",{className:"text-lg font-semibold text-ellipsis overflow-hidden",children:o.fileName})]}),o.shardProgress&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Current Shard"}),(0,a.jsxs)("p",{className:"text-lg font-semibold",children:[o.shardProgress.shardIndex+1," of ",o.shardProgress.totalShards]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"Shard Size"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:i(o.shardProgress.bytesTotal)})]})]})]}),"error"===o.status&&(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("p",{className:"text-red-700",children:o.error})]}),"completed"===o.status&&(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-green-800",children:"Success"}),(0,a.jsx)("p",{className:"text-green-700 mb-2",children:"File uploaded successfully to Storacha!"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-green-800 w-20",children:"CID:"}),(0,a.jsx)("code",{className:"bg-green-100 px-2 py-1 rounded text-green-800 text-sm flex-1 overflow-x-auto",children:o.cid})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-green-800 w-20",children:"URL:"}),(0,a.jsx)("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline text-sm overflow-x-auto",children:o.url})]})]})]})]})]})};function m(){let[e,s]=(0,r.useState)();return(0,a.jsxs)("div",{className:"space-y-10",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"S3 to Storacha Migration Demo"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Download files from S3 and upload them to Storacha with detailed progress tracking"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsx)(d,{onFileDownload:e=>{s(e)}}),(0,a.jsx)(o,{file:e})]}),(0,a.jsxs)("div",{className:"text-center p-6 bg-gray-50 rounded-xl",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"How It Works"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"This demo showcases the capabilities of the storacha-migration-tool library, allowing you to migrate files from Amazon S3 to Storacha (Web3.Storage) with detailed progress tracking."}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("h3",{className:"font-medium text-storacha",children:"Step 1: Download"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Enter your S3 credentials and file path to download a file with progress tracking."})]}),(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("h3",{className:"font-medium text-storacha",children:"Step 2: Upload"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Enter your Storacha email and select a space to upload the downloaded file."})]}),(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow-sm",children:[(0,a.jsx)("h3",{className:"font-medium text-storacha",children:"Step 3: Access"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Once uploaded, receive the IPFS CID and URL to access your file on the decentralized web."})]})]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);